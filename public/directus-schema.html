<!DOCTYPE html>
<html>
<head>
    <title>Directus Schema Analyzer</title>
    <style>
        body { font-family: monospace; background: #1e1e1e; color: #d4d4d4; padding: 20px; }
        pre { background: #252526; padding: 15px; border-radius: 5px; overflow-x: auto; }
        button { background: #0e639c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-bottom: 15px; }
        button:hover { background: #1177bb; }
    </style>
</head>
<body>
    <h1>Directus Schema</h1>
    <div id="output">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    
    <script>
        async function getSchema() {
            try {
                const output = document.getElementById('output');
                output.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º—ã Directus...';

                // –ü–æ–ª—É—á–∞–µ–º —Å—Ö–µ–º—É —á–µ—Ä–µ–∑ –Ω–∞—à API –º–∞—Ä—à—Ä—É—Ç
                const res = await fetch('/api/directus-schema');
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }
                
                const data = await res.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // –°—Ç—Ä–æ–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                let html = '<pre>';
                html += '=== DIRECTUS SCHEMA ===\n\n';
                html += `‚úì –í—Å–µ–≥–æ –∫–æ–ª–ª–µ–∫—Ü–∏–π: ${data.total_collections}\n`;
                html += `‚úì –í—Å–µ–≥–æ –ø–æ–ª–µ–π: ${data.total_fields}\n\n`;
                
                Object.keys(data.fields).sort().forEach(collectionName => {
                    const fields = data.fields[collectionName];
                    html += `üìã ${collectionName.toUpperCase()}\n`;
                    html += `   –ü–æ–ª–µ–π: ${fields.length}\n`;
                    fields.forEach(field => {
                        let extra = '';
                        if (field.required) extra += ' [REQUIRED]';
                        if (field.readonly) extra += ' [READONLY]';
                        html += `     ‚Ä¢ ${field.field} [${field.type}]${extra}\n`;
                    });
                    html += '\n';
                });
                
                html += '</pre>';
                output.innerHTML = html;
                
            } catch (error) {
                document.getElementById('output').innerHTML = `<pre>‚ùå –û—à–∏–±–∫–∞: ${error.message}\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.</pre>`;
                console.error('Schema error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ä–∞–∑—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        getSchema();
        
        // –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
        window.reloadSchema = function() {
            document.getElementById('output').innerHTML = '–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...';
            getSchema();
        };
    </script>
</body>
</html>
