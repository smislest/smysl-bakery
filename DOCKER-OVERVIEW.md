# ğŸ“‹ ĞĞ±Ğ·Ğ¾Ñ€ Docker ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ

```
smysl-bakery/
â”œâ”€â”€ Dockerfile                    # Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑĞ±Ğ¾Ñ€ĞºĞ¸ Docker Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°
â”œâ”€â”€ .dockerignore                 # Ğ¤Ğ°Ğ¹Ğ»Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ·
â”œâ”€â”€ docker-compose.yml            # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
â”œâ”€â”€ .env.production.example       # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ° Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
â”œâ”€â”€ .env.production              # Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ (ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ, Ğ½Ğµ Ğ² Git!)
â”œâ”€â”€ deploy.sh                     # Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ
â”œâ”€â”€ test-docker.bat              # Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Docker (Windows)
â”œâ”€â”€ DOCKER-QUICKSTART.md         # Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚
â”œâ”€â”€ DEPLOYMENT.md                # ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ
â”œâ”€â”€ UPLOAD-TO-SERVER.md          # ĞšĞ°Ğº Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€
â””â”€â”€ MONITORING.md                # ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
```

---

## ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

### Dockerfile
**Multi-stage** ÑĞ±Ğ¾Ñ€ĞºĞ° Next.js Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ:
- **Stage 1 (deps)**: Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
- **Stage 2 (builder)**: Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- **Stage 3 (runner)**: ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ production Ğ¾Ğ±Ñ€Ğ°Ğ·

**Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°**: ~150-200 MB (Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 1+ GB Ñ node_modules)

### .dockerignore
Ğ˜ÑĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ· ÑĞ±Ğ¾Ñ€ĞºĞ¸:
- `node_modules/` - Ğ±ÑƒĞ´ÑƒÑ‚ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾
- `.next/` - Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿ĞµÑ€ĞµÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ¾
- `.git/` - Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ² production
- Ğ›Ğ¾Ğ³Ğ¸ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

### docker-compose.yml
ĞĞ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹:
- **web**: Next.js Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
- ĞŸĞ¾Ñ€Ñ‚Ñ‹: `3000:3000`
- ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ· `.env.production`
- ĞĞ²Ñ‚Ğ¾Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº: `restart: unless-stopped`

### .env.production
**Ğ’ĞĞ–ĞĞ**: Ğ­Ñ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ» ĞĞ• Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ² Git!

Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:
```env
NEXT_PUBLIC_DIRECTUS_URL=...
NEXT_PUBLIC_DIRECTUS_TOKEN=...
DIRECTUS_URL=...
DIRECTUS_TOKEN=...
NODE_ENV=production
```

### deploy.sh
ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ:
1. ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹
2. Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ·
3. Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ·
4. Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹
5. ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ

---

## Workflow Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ

### 1ï¸âƒ£ ĞŸĞµÑ€Ğ²Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ

```bash
# ĞĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
cd ~
git clone <repo> smysl-bakery
cd smysl-bakery

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ .env.production
cp .env.production.example .env.production
nano .env.production
# Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ

# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ
chmod +x deploy.sh
./deploy.sh
```

### 2ï¸âƒ£ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°

```bash
# ĞĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
cd ~/smysl-bakery
git pull origin main
./deploy.sh
```

### 3ï¸âƒ£ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ²

```bash
docker compose logs -f web
```

### 4ï¸âƒ£ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº

```bash
docker compose restart
```

### 5ï¸âƒ£ ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

```bash
docker compose down
```

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Internet (Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ HTTPS (443)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Nginx (reverse proxy + SSL)        â”‚
â”‚     - SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ¾Ñ‚ Let's Encrypt   â”‚
â”‚     - ĞŸÑ€Ğ¾ĞºÑĞ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ° localhost:3000      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ HTTP (3000)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Docker Container: web             â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Next.js 16 (Node.js 20)         â”‚ â”‚
â”‚  â”‚   - Standalone build              â”‚ â”‚
â”‚  â”‚   - Port 3000                     â”‚ â”‚
â”‚  â”‚   - Auto-restart                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ HTTPS API calls
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Directus CMS (Render.com)            â”‚
â”‚    - smysl-bakery-directus.onrender.com â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

### Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Next.js

| ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ“Ğ´Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ |
|-----------|----------|------------------|
| `NEXT_PUBLIC_DIRECTUS_URL` | URL Directus CMS | Client-side |
| `NEXT_PUBLIC_DIRECTUS_TOKEN` | Ğ¢Ğ¾ĞºĞµĞ½ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° | Client-side |
| `DIRECTUS_URL` | URL Directus CMS | Server-side |
| `DIRECTUS_TOKEN` | Ğ¢Ğ¾ĞºĞµĞ½ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° | Server-side |
| `NODE_ENV` | Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ | Build & Runtime |

### Ğ”Ğ»Ñ Docker

| ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ“Ğ´Ğµ |
|-----------|----------|-----|
| `DOCKER_BUILD` | Ğ¤Ğ»Ğ°Ğ³ Docker ÑĞ±Ğ¾Ñ€ĞºĞ¸ | Dockerfile |
| `NEXT_TELEMETRY_DISABLED` | ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ»ĞµĞ¼ĞµÑ‚Ñ€Ğ¸Ñ | Dockerfile |

---

## Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸

### ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸

Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² `docker-compose.yml`:

```yaml
services:
  web:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
```

### ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```bash
# Ğ’ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
docker stats

# ĞĞ´Ğ¸Ğ½ Ñ€Ğ°Ğ·
docker stats --no-stream smysl-bakery-web
```

---

## Troubleshooting

### âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: "Error loading site settings"

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°**: Directus Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**:
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ `.env.production`
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Directus: `curl https://smysl-bakery-directus.onrender.com`
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² Directus Admin

### âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: "Port 3000 is already in use"

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°**: ĞŸĞ¾Ñ€Ñ‚ Ğ·Ğ°Ğ½ÑÑ‚ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ¼

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**:
```bash
# ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ
sudo lsof -i :3000

# Ğ˜Ğ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ñ€Ñ‚ Ğ² docker-compose.yml
ports:
  - "8080:3000"
```

### âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: "Cannot connect to Docker daemon"

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°**: Docker Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**:
```bash
# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Docker
sudo systemctl start docker

# Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ
sudo usermod -aG docker $USER
# Ğ’Ñ‹Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ¸ Ğ²Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°
```

### âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: "npm ERR! network"

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°**: ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ ÑĞµÑ‚ÑŒÑ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ±Ğ¾Ñ€ĞºĞ¸

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**:
```bash
# ĞŸĞµÑ€ĞµÑĞ¾Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ±ĞµĞ· ĞºÑÑˆĞ°
docker compose build --no-cache
```

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### âœ… Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾

- âœ… ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ Ğ½ĞµĞ¿Ñ€Ğ¸Ğ²Ğ¸Ğ»ĞµĞ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
- âœ… ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ½Ğµ Ğ² Git
- âœ… ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ· (Alpine Linux)
- âœ… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ·Ğµ
- âœ… HTTPS Ğ´Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹ (Ñ‡ĞµÑ€ĞµĞ· Nginx)

### ğŸ”’ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸

1. **Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞ¹Ñ‚Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ· Node.js**
   ```bash
   docker pull node:20-alpine
   ```

2. **Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ secrets Ğ´Ğ»Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²** (Ğ´Ğ»Ñ Docker Swarm)
   ```yaml
   secrets:
     - directus_token
   ```

3. **Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ½Ğ° ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸**
   ```bash
   docker scan smysl-bakery-web
   ```

4. **Firewall Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°**
   ```bash
   sudo ufw allow 22/tcp   # SSH
   sudo ufw allow 80/tcp   # HTTP
   sudo ufw allow 443/tcp  # HTTPS
   sudo ufw deny 3000/tcp  # Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Next.js
   sudo ufw enable
   ```

---

## ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

Docker Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ layer caching:
- Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (`npm ci`) ĞºÑÑˆĞ¸Ñ€ÑƒÑÑ‚ÑÑ
- ĞŸĞµÑ€ĞµÑĞ±Ğ¾Ñ€ĞºĞ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ `package.json`

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ±Ğ¾Ñ€ĞºĞ¸

```bash
# Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ñ ĞºÑÑˆĞµĞ¼ (Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ)
docker compose build

# Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ±ĞµĞ· ĞºÑÑˆĞ° (Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ, Ğ½Ğ¾ Ñ‡Ğ¸Ñ‰Ğµ)
docker compose build --no-cache

# ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ°
docker compose build --parallel
```

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Next.js

Ğ’ production Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Next.js Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
- ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ JS/CSS
- ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
- Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Gzip compression
- Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ static assets

---

## Backup & Recovery

### Backup ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸

```bash
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ backup
tar -czf smysl-bakery-config-$(date +%Y%m%d).tar.gz \
    docker-compose.yml \
    .env.production \
    Dockerfile

# Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
tar -xzf smysl-bakery-config-20260109.tar.gz
```

### Backup Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ volumes)

```bash
docker run --rm \
    -v smysl-bakery_data:/data \
    -v $(pwd):/backup \
    alpine tar czf /backup/data-backup.tar.gz /data
```

---

## CI/CD Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

### GitHub Actions Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€

```yaml
name: Deploy to reg.ru

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Deploy to server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd ~/smysl-bakery
            git pull origin main
            ./deploy.sh
```

---

## ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸

- [Docker Documentation](https://docs.docker.com/)
- [Docker Compose Reference](https://docs.docker.com/compose/compose-file/)
- [Next.js Docker](https://nextjs.org/docs/deployment#docker-image)
- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)
- [reg.ru Documentation](https://www.reg.ru/support/)
